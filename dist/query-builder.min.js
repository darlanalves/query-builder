!function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(){t(this,e),this.reset()}return n(e,[{key:"reset",value:function(){this.$$filters=[],this.$$select=[],this.$$pagination={page:1,limit:e.DEFAULT_PAGE_SIZE,skip:0},this.$$sorting=[]}},{key:"sort",value:function(e,t){var n=t?"desc":"asc",i=[e,n];return this.$$sorting.push(i),this}},{key:"addFilter",value:function(e,t,n){var i=this.$$filters.some(function(i){return e===i.name&&t===i.operator?(i.value=n,!0):void 0});if(!i){var r={name:e,operator:t,value:n};this.$$filters.push(r)}}},{key:"select",value:function(){var e=void 0,t=void 0;if(1===arguments.length&&(t=arguments[0]),"string"==typeof t&&(t=[t]),2===arguments.length&&(e=arguments[0],t=arguments[1],t=t.map(function(t){return e+"."+t})),!Array.isArray(t))throw new TypeError("Invalid fields. Must be an array of strings");return this.$$select.push.apply(this.$$select,t),this}},{key:"where",value:function(e){return r.create(this,e)}},{key:"page",value:function(e){return this.$$pagination.page=Number(e),this}},{key:"skip",value:function(e){return this.$$pagination.skip=Number(e),this}},{key:"limit",value:function(e){return this.$$pagination.limit=Number(e),this}},{key:"toJSON",value:function(){var e=function(e){return{name:e.name,operator:e.operator,value:e.value}};return this.serialize(e)}},{key:"toJSONArray",value:function(){var e=function(e){return[e.name,e.operator,e.value]};return this.serialize(e)}},{key:"serialize",value:function(e){var t=this.$$pagination,n=this.$$filters.map(e),i=[],r=this.$$select.slice();return this.$$sorting.forEach(function(e){return i.push([e[0],e[1]])}),{filters:n,sorting:i,fields:r,page:t.page,skip:t.skip,limit:t.limit}}}],[{key:"create",value:function(){return new e}}]),e}();i.DEFAULT_PAGE_SIZE=20;var r=function(){function e(n,i){t(this,e),this.$$query=n,this.$$field=i}return n(e,null,[{key:"create",value:function(t,n){return new e(t,n)}},{key:"add",value:function(t,n){function i(e){return this.$$query.addFilter(this.$$field,n,e),this.$$query}var r=e.prototype;if(t in r)throw new Error("Operator already exists: "+t);r[t]=i}}]),e}(),u={lt:"<",lte:"<=",gt:">",gte:">=","in":"in",eq:"=",ne:"!=",like:"~",st:"^",end:"$"};Object.keys(u).forEach(function(e){var t=u[e];r.add(e,t)}),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:e.QueryBuilder=i}(this);